const puppeteer = require('puppeteer');

const base_url = "http://client:10000"
const browser_option = {
    headless: true,
    args: [
        '-wait-for-browser',
        '--no-sandbox', '--disable-gpu',
        '--js-flags="--noexpose_wasm"'
    ]
}

const wait = ms => new Promise(resolve => setTimeout(resolve, ms));

const visit = async(url) => {
    console.log(`[+] Visiting: ${url}`);

    const username = "tom";
    const password = "huga";

    const browser = await puppeteer.launch(browser_option);
    try {
        const page = await browser.newPage();
        await page.goto(base_url + '/login', {timeout: 3000});
        await page.type('#name', username);
        await page.type('#password', password);
        await page.click('#login');
        await wait(1000);

        await page.goto(url, {timeout: 3000});
        await wait(3000);
        await page.close();
    } catch(e) {
        console.log("[-] " + e);
    }

    console.log(`[+] Crawler done`);
    await browser.close();
}

module.exports = { visit }